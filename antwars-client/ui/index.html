<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ant Wars Client</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #2c3e50;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }
        #game-container {
            width: 960px;
            height: 640px;
            background-color: #34495e;
            border: 2px solid #ecf0f1;
            position: relative;
        }
        #login-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
        }
        button {
            padding: 10px 20px;
            font-size: 18px;
            cursor: pointer;
            background-color: #27ae60;
            color: white;
            border: none;
            border-radius: 5px;
            margin-top: 20px;
        }
        button:hover {
            background-color: #2ecc71;
        }
        #log-area {
            width: 960px;
            height: 150px;
            background: #000;
            color: #0f0;
            font-family: monospace;
            overflow-y: scroll;
            margin-top: 10px;
            padding: 10px;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <h1>Ant Wars Remake (Tauri Client)</h1>
    <div id="game-container">
        <div id="login-screen">
            <h2>Welcome to Ant Wars</h2>
            <p>Connect to Local Private Server</p>
            <button id="btn-login">Login (GameMember.load)</button>
        </div>
    </div>
    <div id="log-area">Logs will appear here...</div>

    <script>
        const API_URL = "http://127.0.0.1:8080/api/flashapi.php";
        const SID = "111"; // Default dev SID

        function log(msg) {
            const el = document.getElementById("log-area");
            el.innerHTML += `<div>[${new Date().toLocaleTimeString()}] ${msg}</div>`;
            el.scrollTop = el.scrollHeight;
        }

        async function sendRequest(method, param = []) {
            const win_param = JSON.stringify({
                mid: 1001, // Mock User ID
                key: "dev_key",
                method: method,
                param: param
            });

            // The Flash game sends form-data: `sid=...&win_param={...}`
            const formData = new URLSearchParams();
            formData.append('sid', SID);
            formData.append('win_param', win_param);

            log(`Sending ${method}...`);

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: formData
                });

                if (!response.ok) {
                    throw new Error(`HTTP Error: ${response.status}`);
                }

                const json = await response.json();
                log(`Response: ${JSON.stringify(json, null, 2)}`);
                return json;

            } catch (err) {
                log(`Error: ${err.message}`);
                console.error(err);
            }
        }

        document.getElementById('btn-login').addEventListener('click', async () => {
            const res = await sendRequest("GameMember.load", []);
            if (res && res.status === 1) {
                alert(`Login Success!\nWelcome, ${res.mrolename} (Level ${res.mlevel})`);
                // Here you would hide login screen and show the Lobby
            }
        });
    </script>
</body>
</html>
